BootStrap: shub
From: shub://elisadonnard/singularity:latest

%labels

    AUTHOR Elisa Donnard
    Version v4.03

%environment
    export SRC=/usr/local/src
    export BIN=/usr/local/bin
    export R_VERSION=R-4.0.3

%apprun R
  exec R "$@"

%apprun Rscript
  exec Rscript "$@"

%runscript
  exec R "$@"    

%post
######
## vim
######

apt-get install -y vim

#####
## R
#####
export SRC=/usr/local/src
export BIN=/usr/local/bin
export R_VERSION=R-4.0.3


%post
  NPROCS=`awk '/^processor/ {s+=1}; END{print s}' /proc/cpuinfo`
  wget https://cran.rstudio.com/src/base/R-4/R-4.0.3.tar.gz
  tar xvf R-4.0.3.tar.gz
  cd R-4.0.3

  apt-get update
  apt-get install -y libblas3 libblas-dev liblapack-dev liblapack3 curl 
  apt-get install -y libgmp10 libgmp-dev
  apt-get install -y gcc fort77 aptitude
  aptitude install -y g++
  aptitude install -y xorg-dev
  aptitude install -y libreadline-dev
  aptitude install -y gfortran
  gfortran --version
  apt install -y libssl-dev libxml2-dev libpcre3-dev liblzma-dev libbz2-dev libcurl4-openssl-dev

  apt-get update

  ./configure --enable-R-static-lib --with-blas --with-lapack --enable-R-shlib=yes
  echo "Will use make with $NPROCS cores."
  make -j${NPROCS}
  make install

  echo install.packages\(\"devtools\"\, repos\=\'https://cloud.r-project.org\'\, Ncpus\=${NPROCS}\) | R --slave
  echo install.packages\(\"ade4\"\, repos\=\'https://cloud.r-project.org\'\, Ncpus\=${NPROCS}\) | R --slave
  echo install.packages\(\"ape\"\, repos\=\'https://cloud.r-project.org/\'\, Ncpus\=${NPROCS}\) | R --slave
  echo install.packages\(\"FD\"\, repos\=\'https://cloud.r-project.org/\'\, Ncpus\=${NPROCS}\) | R --slave
  echo install.packages\(\"ggplot2\"\, repos\=\'https://cloud.r-project.org/\'\, Ncpus\=${NPROCS}\) | R --slave
  echo install.packages\(\"BiocManager\"\, repos\=\'https://cloud.r-project.org/\'\, Ncpus\=${NPROCS}\) | R --slave
  R --slave -e "BiocManager::install('tidyverse')"
  R --slave -e "BiocManager::install('edgeR')"
  R --slave -e "BiocManager::install('DESeq2')"
  R --slave -e "BiocManager::install('gplots')"
  R --slave -e "BiocManager::install('Biobase', dep = TRUE)"
  R --slave -e "BiocManager::install('DropletUtils', dep = TRUE)"
  R --slave -e "BiocManager::install('stringr', dep = TRUE)"
  R --slave -e "BiocManager::install('densityClust', dep = TRUE)"
  R --slave -e "BiocManager::install('RColorBrewer', dep = TRUE)"
  R --slave -e "BiocManager::install('Rtsne', dep = TRUE)"
  R --slave -e "BiocManager::install('ggpubr', dep = TRUE)"
  R --slave -e "BiocManager::install('limSolve', dep = TRUE)"
  R --slave -e "BiocManager::install('scran', dep = TRUE)"
  R --slave -e "BiocManager::install('fpc', dep = TRUE)"
  R --slave -e "BiocManager::install('irlba', dep = TRUE)"
  R --slave -e "BiocManager::install(SCENIC)"
  R --slave -e "BiocManager::install(AUCell)"
  R --slave -e "BiocManager::install(RcisTarget)"
  R --slave -e "BiocManager::install(SCopeLoomR)"
  R --slave -e "BiocManager::install(KernSmooth)"
  R --slave -e "BiocManager::install(BiocParallel)"
  R --slave -e "BiocManager::install(ggplot2)"
  R --slave -e "BiocManager::install(data.table)"
  R --slave -e "BiocManager::install(grid)"
  R --slave -e "BiocManager::install(ComplexHeatmap)"
  R --slave -e "devtools::install_github('garber-lab/SignallingSingleCell')"  

###################
# mount directories

mkdir /seq/lincRNA
